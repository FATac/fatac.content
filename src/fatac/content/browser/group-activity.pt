<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">

<head>
    <metal:block fill-slot="top_slot"
                 tal:define="dummy python:request.set('disable_border',1);
                             disable_column_one python:request.set('disable_plone.leftcolumn',1);
                             disable_column_two python:request.set('disable_plone.rightcolumn',1);" />
</head>

<body>

<tal:comment replace="nothing">
    Please note that this template fills the "content" slot instead of the
    "main" slot, this is done so we can provide stuff like the content
    tabs. This also means that we have to supply things that are normally
    present from main_template.
</tal:comment>

<metal:main fill-slot="content">
    <tal:main-macro metal:define-macro="main"
                    tal:define="memberinfo context/portal_membership/getMemberInfo;
                                member context/@@plone_portal_state/member;
                                groupname request/groupname;
                                group python:context.portal_groups.getGroupById(groupname);
                                groupmembers python: context.portal_groups.getGroupMembers(groupname);
                                targetobject context/portal_groupdata;
                                property targetobject/propertyMap;
                                portal_url context/portal_url">



        <div id="edit-bar" tal:condition="view/can_edit">
            <h5 class="hiddenStructure">Views</h5>

            <ul id="content-views" class="contentViews">
                <li>
                    <a href=""
                       tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/dashboard"
                       i18n:translate="label_dashboard">Dashboard</a>
                </li>
                <li>
                    <a href=""
                       tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/@@manage-dashboard"
                       i18n:translate="label_portlets">Edita Portlets</a>
                </li>
                <li class="selected">
                    <a href=""
                       tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/@@manage-groups"
                       i18n:translate="">Grups</a>
                </li>
                <li>
                    <a href=""
                       tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/@@my-playlists"
                       i18n:translate="">Playlists</a>
                </li>
                <li>
                    <a href=""
                       tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/@@my-activity"
                       i18n:translate="">Activitat</a>
                </li>
            </ul>

            <div class="contentActions" tal:condition="view/can_edit">
              &nbsp;
            </div>
        </div>
        
        <div metal:use-macro="context/global_statusmessage/macros/portal_message">
            Portal status message
        </div>
        <dl tal:condition="python:view.empty() and view.can_edit()"
            class="portalMessage info visualClear" id="dashboard-info-message">
            <dt i18n:translate="">Info</dt>
            <dd i18n:translate="info_empty_dashboard">
                Your dashboard is currently empty. Click the 
                <em>edit</em> tab to assign some personal 
                portlets.
            </dd>
        </dl>

        

        <div id="content">
            
            <h1 class="documentFirstHeading">
                <span tal:replace="groupname" />
            </h1>

            <div id="submenu">
                <a class="link-submenu" href=""
                   tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/@@group-view?groupname=${groupname};"
                   i18n:translate="">Escriptori del Grup</a>

                <a class="link-submenu" href=""
                   tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/@@group-members?groupname=${groupname}&fm=True;"
                   i18n:translate="">Membres</a>

                <a class="link-submenu selected" href=""
                   tal:attributes="href string:${context/@@plone_portal_state/navigation_root_url}/@@group-activity?groupname=${groupname};"
                   i18n:translate="">Activitat</a>

            </div>

            <a href=""
               class="link-parent"
               tal:attributes="href string:$portal_url/@@manage-groups"
               i18n:translate="label_up_to_groups_overview">
               Up to Groups Overview
            </a>

            <div id="group-activity" class="row">
<!--
                <div class="span10" tal:define="search python:context.portal_catalog.searchResults(creator=groupmembers, 
                                                                                                   sort_on='modified',
                                                                                                   sort_order='reverse',)">
-->
                <div class="span10" tal:define="search python:view.searchActivityResults(groupmembers, groupname)">
                    <tal:re tal:repeat="obj search" tal:define="plone_view context/@@plone;
                                                                     getIcon nocall:plone_view/getIcon;
                                                                     normalizeString nocall:plone_view/normalizeString;
                                                                     toLocalizedTime nocall:plone_view/toLocalizedTime;">
                        <div class="alert-message warning" tal:define="item_icon python:getIcon(obj);
                                                                       item_wf_state obj/review_state;
                                                                       item_wf_state_class python:'state-' + normalizeString(item_wf_state);">

                             <img tal:replace="structure item_icon/html_tag" />
                             <a href="" tal:attributes="href obj/getURL; class string:$item_wf_state_class">
                                 <span tal:content="obj/Title" />
                             </a>
                             <span class="discreet" i18n:translate="text_creator_date">
                                 by
                                 <span tal:define="creator obj/Creator;"
                                       tal:content="python:memberinfo and memberinfo['fullname'] or creator"
                                       tal:omit-tag=""
                                       i18n:name="creator">creator</span>,
                                 last updated:
                                 <span tal:content="python:toLocalizedTime(obj.ModificationDate, long_format=1)"
                                       tal:omit-tag=""
                                       i18n:name="date">date</span>
                             </span>

                             <p>
                                 <span tal:content="obj/Description" />
<!--
                                 Modificat el: <span class="label important" tal:content="python:toLocalizedTime(playlist.ModificationDate)">May 5</span>
-->
                             </p>

                        </div>
                    </tal:re>
                </div>
                    
          
            </div>

            <div id="content-core">                
                
                <div class="visualClear"><!-- --></div>
            </div>
        </div>

    </tal:main-macro>
</metal:main>

</body>
</html>
